pipeline {
    agent any
    
    stages {
//this stage sets up the virtual environment for the unit tests
    stage('Setup') {
        steps {
            sh """sudo apt install python3-venv -y 
            python3 -m venv venv
            . ./venv/bin/activate
            pip3 install -r requirements.txt
            """
            }
        }
// This stage runs unit tests and saves them to files to be picked up post build 
        stage('Test') {
            steps {
                sh """ . ./venv/bin/activate
                python3 -m pytest --junitxml unittests.xml
                python3 -m pytest --cov-report xml:coverage.xml --cov=tests/
                deactivate
                rm -rf /venv""" 
            }
    }  
}

